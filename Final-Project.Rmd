---
title: "R Notebook"
output: html_notebook
---


```{r}
library(data.table)       #Load all required packages
library(rvest)
library(lubridate)
library(dbplyr)
library(DataComputing)
library(magrittr)
library(Hmisc)
library(party)
library(rpart)

rm(list = ls())            #Clean up environment

```


###Background Information

This dataset contains policy data for 50 US states and DC from 2001 to 2017. Data include information related to state legislation and regulations on nutrition, physical activity, and obesity in settings such as early care and education centers, restaurants, schools, work places, and others. To identify individual bills, use the identifier ProvisionID. A bill or citation may appear more than once because it could apply to multiple health or policy topics, settings, or states. 


```{r}


getwd()                          #Get working directory
setwd("~/Downloads")             #Set working directory 

untidy <-read.csv("CDC_Nutrition__Physical_Activity__and_Obesity_-_Legislation.csv")    #Read file in table format and create a data frame from it

gc(reset=TRUE)                 #Change from data frame to data table
tracemem(untidy)
untidy <- as.data.table(untidy)
gc()


```




##What can we do with this data?

This dataset can be useful in looking at 

```{r}

untidy           #Take a look


```

```{r}

#Clean Data 
#Change variables to start with lowercase/ make easier to use

Legislation <-
  untidy %>%
  rename(year = Year, quarter = Quarter, state = LocationAbbr, healthTopic = HealthTopic, policyTopic = PolicyTopic, dataSource = DataSource, setting = Setting, title = Title, status = Status, citation = Citation, statusAltValue = StatusAltValue, dataType = DataType, comments = Comments, enDate = EnactedDate, effDate = EffectiveDate, coordinates = GeoLocation, display = DisplayOrder)

Legislation



```







## What type of information can we find with this data?

We can see how much legislation has been passed in certain years, which years have been the most progressive, which states have more legislation than others, which topic has been most popular, and more. This information can give government officials the ability to see where certain states need to improve, which topics need to be emphasized, and more.


## Which year passed the most legislation?


```{r}

yearlyData <-
Legislation %>%
  group_by(year) %>%
  summarise(total = sum(year)) %>%
  mutate(total = total/1000)


yearlyData %>%
  ggplot(aes(x=year,y=total ))+
  geom_bar(stat='identity',position='stack', width=.9, fill = "red") +
  ylab("Total (1000s)") +
  xlab("Year") 


```

Each bar in the chart represents one year. One can see that in 2011, the most legislation/regulation has been passed between 2001 and 2017.

## Legislation on the Map

```{r}

#coordinates <- Legislation[,17]

#long <- sapply(Legislation$coordinates, "[", 1)


#lat <- sapply(Legislation$coordinates, "[", 2)

#long


```

## Predicting Status based on Year and State

```{r}

#predictedStatus <-
  #Legislation %>%
  #sample_n(200) %>%
    #rpart(status ~ year + state, data = .)

#rpart.plot(predictedStatus, roundint = FALSE)


```

##

```{r}

Legislation %>%
  sample_n(200) %>%
  group_by(year, healthTopic, PolicyTypeID) %>%
  summarise(total = sum(year)) %>%
  mutate(total = total/1000) %>%
  ggplot(aes(x= year, y = total)) +
  geom_point(color = "red") +
  facet_grid(PolicyTypeID ~ healthTopic) +
  ylab("total (1000s)") +
  xlab("Year")


```


As we can see, there has been a lot less regulation than legislation. Nutrititional legislation appears to be the most popular with an exponentially growing total without counting years after about 2012.


## Predict Status from year and state

```{r}


  predictedStatus <-
  Legislation %>%
  sample_n(20) %>%
    rpart(status ~ year + state, data = .)
  

```






















